<!DOCTYPE html>
<html>
<head>
    <title>Monaco Editor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1e1e1e;
            font-family: 'Consolas', 'Monaco', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #file-switcher {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #252526;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            min-width: 400px;
            max-width: 600px;
            max-height: 500px;
            display: none;
            flex-direction: column;
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
            z-index: 2000;
        }
        #file-switcher.visible {
            display: flex;
        }
        #file-switcher-header {
            padding: 15px;
            border-bottom: 1px solid #3c3c3c;
            color: #cccccc;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #file-switcher-title {
            font-weight: bold;
            margin-right: 30px;
        }
        #file-switcher-shortcuts {
            font-size: 11px;
            color: #888;
        }
        #file-switcher-list {
            flex: 1;
            overflow-y: auto;
            max-height: 400px;
            outline: none;
        }
        .file-switcher-item {
            padding: 12px 15px;
            color: #cccccc;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            border-bottom: 1px solid #3c3c3c;
        }
        .file-switcher-item:hover {
            background: #2d2d30;
        }
        .file-switcher-item.active {
            background: #1e1e1e;
            color: #fff;
            border-left: 3px solid #007acc;
        }
        .file-switcher-item.selected {
            background: #2d2d30;
            border-left: 3px solid #4EC9B0;
        }
        .file-switcher-name {
            flex: 1;
        }
        .file-switcher-close {
            margin-left: 10px;
            opacity: 0.6;
            font-weight: bold;
        }
        .file-switcher-close:hover {
            opacity: 1;
            color: #e06c75;
        }
        #file-switcher-new {
            padding: 12px 15px;
            color: #4EC9B0;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            border-top: 1px solid #3c3c3c;
        }
        #file-switcher-new:hover {
            background: #2d2d30;
        }
        #current-file-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #252526;
            color: #cccccc;
            padding: 6px 12px;
            border-radius: 2px;
            font-size: 12px;
            opacity: 0.7;
            z-index: 1000;
            cursor: pointer;
        }
        #current-file-indicator:hover {
            opacity: 1;
        }
        .selector {
            position: fixed;
            bottom: 10px;
            z-index: 1000;
            background: #252526;
            color: #cccccc;
            border: 1px solid #3c3c3c;
            padding: 8px 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            cursor: pointer;
            border-radius: 2px;
        }
        .selector:hover {
            background: #2d2d30;
        }
        #language-selector {
            right: 190px;
        }
        #theme-selector {
            right: 20px;
        }
        #container {
            flex: 1;
            width: 100%;
            padding-bottom: 40px;
        }
    </style>
</head>
<body>
    <div id="current-file-indicator"></div>
    <div id="file-switcher">
        <div id="file-switcher-header">
            <span id="file-switcher-title">Files</span>
            <span id="file-switcher-shortcuts">Ctrl+P: Toggle | ↑↓: Navigate | Enter: Select | Double-click: Rename</span>
        </div>
        <div id="file-switcher-list" tabindex="0"></div>
        <div id="file-switcher-new">+ New File</div>
    </div>
    <select id="language-selector" class="selector">
        <option value="plaintext">Plain Text</option>
        <option value="cpp">C++</option>
        <option value="c">C</option>
        <option value="javascript">JavaScript</option>
        <option value="typescript">TypeScript</option>
        <option value="python">Python</option>
        <option value="java">Java</option>
        <option value="csharp">C#</option>
        <option value="go">Go</option>
        <option value="rust">Rust</option>
        <option value="html">HTML</option>
        <option value="css">CSS</option>
        <option value="json">JSON</option>
        <option value="markdown">Markdown</option>
        <option value="sql">SQL</option>
        <option value="php">PHP</option>
    </select>
    <select id="theme-selector" class="selector">
        <option value="one-dark-black" selected>VS Dark Black</option>
        <option value="vs-dark">VS Code Dark</option>
        <option value="vs">VS Code Light</option>
    </select>
    <div id="container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});

        require(['vs/editor/editor.main'], function() {
            // Define VS Dark Black theme
            monaco.editor.defineTheme('one-dark-black', {
                base: 'vs-dark',
                inherit: true,
                rules: [],
                colors: {
                    'editor.background': '#000000',
                }
            });

            // File management
            var files = {};
            var currentFileId = null;
            var fileCounter = 0;
            var editor = null;
            var saveTimeout = null;
            var selectedFileIndex = 0;

            // Initialize editor
            editor = monaco.editor.create(document.getElementById('container'), {
                value: '',
                language: 'cpp',
                theme: 'one-dark-black',
                fontSize: 16,
                tabSize: 2,
                insertSpaces: true,
                autoClosingBrackets: 'always',
                autoClosingQuotes: 'always',
                formatOnType: true,
                formatOnPaste: true,
                renderLineHighlight: 'none',
                quickSuggestions: false,
                suggestOnTriggerCharacters: false,
                acceptSuggestionOnEnter: 'off',
                tabCompletion: 'off',
                wordBasedSuggestions: false,
                parameterHints: { enabled: false },
                minimap: { enabled: false },
                scrollbar: {
                    verticalScrollbarSize: 10,
                    horizontalScrollbarSize: 10
                }
            });

            // Load theme
            var savedTheme = localStorage.getItem('editorTheme') || 'one-dark-black';
            monaco.editor.setTheme(savedTheme);
            document.getElementById('theme-selector').value = savedTheme;

            // Load files from localStorage
            function loadFiles() {
                var savedFiles = localStorage.getItem('files');
                var savedCurrentId = localStorage.getItem('currentFileId');

                if (savedFiles) {
                    files = JSON.parse(savedFiles);
                    fileCounter = parseInt(localStorage.getItem('fileCounter')) || Object.keys(files).length;
                }

                // If no files, create a default one
                if (Object.keys(files).length === 0) {
                    createNewFile();
                } else {
                    currentFileId = savedCurrentId || Object.keys(files)[0];
                    renderTabs();
                    loadFile(currentFileId);
                }
            }

            // Save files to localStorage
            function saveFiles() {
                localStorage.setItem('files', JSON.stringify(files));
                localStorage.setItem('currentFileId', currentFileId);
                localStorage.setItem('fileCounter', fileCounter.toString());
            }

            // Save current file content
            function saveCurrentFile() {
                if (currentFileId && files[currentFileId]) {
                    files[currentFileId].content = editor.getValue();
                    files[currentFileId].language = editor.getModel().getLanguageId();
                    saveFiles();
                }
            }

            // Auto-save
            editor.onDidChangeModelContent(function() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(saveCurrentFile, 500);
            });

            // Create new file
            function createNewFile() {
                fileCounter++;
                var fileId = 'file-' + fileCounter;
                files[fileId] = {
                    name: 'untitled-' + fileCounter + '.txt',
                    content: '',
                    language: 'plaintext'
                };
                currentFileId = fileId;
                renderTabs();
                loadFile(fileId);
                saveFiles();
            }

            // Switch to file
            function switchToFile(fileId) {
                if (fileId === currentFileId) return;
                saveCurrentFile();
                currentFileId = fileId;
                renderTabs();
                loadFile(fileId);
                saveFiles();
            }

            // Load file into editor
            function loadFile(fileId) {
                if (!files[fileId]) return;
                var file = files[fileId];
                editor.setValue(file.content);
                monaco.editor.setModelLanguage(editor.getModel(), file.language);
                document.getElementById('language-selector').value = file.language;
            }

            // Close file
            function closeFile(fileId) {
                if (Object.keys(files).length === 1) {
                    alert('Cannot close the last file');
                    return;
                }

                delete files[fileId];

                // Switch to another file
                if (currentFileId === fileId) {
                    currentFileId = Object.keys(files)[0];
                    loadFile(currentFileId);
                }

                renderTabs();
                saveFiles();
            }

            // Rename file
            function renameFile(fileId) {
                var file = files[fileId];
                var newName = prompt('Enter new name:', file.name);
                if (newName && newName.trim()) {
                    file.name = newName.trim();
                    renderTabs();
                    saveFiles();
                }
            }

            // Render files in switcher
            function renderTabs() {
                var list = document.getElementById('file-switcher-list');
                list.innerHTML = '';

                // Update current file indicator
                if (currentFileId && files[currentFileId]) {
                    document.getElementById('current-file-indicator').textContent = files[currentFileId].name;
                }

                // Add file items
                var fileIds = Object.keys(files);
                fileIds.forEach(function(fileId, index) {
                    var file = files[fileId];
                    var item = document.createElement('div');
                    var classes = 'file-switcher-item';
                    if (fileId === currentFileId) classes += ' active';
                    if (index === selectedFileIndex) classes += ' selected';
                    item.className = classes;

                    var nameSpan = document.createElement('span');
                    nameSpan.className = 'file-switcher-name';
                    nameSpan.textContent = file.name;
                    nameSpan.addEventListener('click', function(e) {
                        e.stopPropagation();
                        selectedFileIndex = index;
                        switchToFile(fileId);
                        renderTabs();
                    });
                    nameSpan.addEventListener('dblclick', function(e) {
                        e.preventDefault();
                        renameFile(fileId);
                    });

                    var closeSpan = document.createElement('span');
                    closeSpan.className = 'file-switcher-close';
                    closeSpan.textContent = '×';
                    closeSpan.addEventListener('click', function(e) {
                        e.stopPropagation();
                        closeFile(fileId);
                    });

                    item.appendChild(nameSpan);
                    item.appendChild(closeSpan);
                    list.appendChild(item);
                });
            }

            // Toggle file switcher
            function toggleFileSwitcher() {
                var switcher = document.getElementById('file-switcher');
                var isOpening = !switcher.classList.contains('visible');

                switcher.classList.toggle('visible');

                // When opening, set selected index to current file and focus
                if (isOpening) {
                    var fileIds = Object.keys(files);
                    selectedFileIndex = fileIds.indexOf(currentFileId);
                    if (selectedFileIndex === -1) selectedFileIndex = 0;
                    renderTabs();

                    // Focus the list to capture keyboard events
                    setTimeout(function() {
                        document.getElementById('file-switcher-list').focus();
                    }, 0);
                } else {
                    // When closing, return focus to editor
                    editor.focus();
                }
            }

            // New file button
            document.getElementById('file-switcher-new').addEventListener('click', function() {
                createNewFile();
                toggleFileSwitcher();
            });

            // Current file indicator click
            document.getElementById('current-file-indicator').addEventListener('click', toggleFileSwitcher);

            // Close file switcher when clicking outside
            document.addEventListener('click', function(e) {
                var switcher = document.getElementById('file-switcher');
                var indicator = document.getElementById('current-file-indicator');

                if (switcher.classList.contains('visible') &&
                    !switcher.contains(e.target) &&
                    !indicator.contains(e.target)) {
                    toggleFileSwitcher();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                var switcher = document.getElementById('file-switcher');
                var isSwitcherOpen = switcher.classList.contains('visible');

                // Ctrl+P: Toggle file switcher
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    toggleFileSwitcher();
                    return;
                }

                // Arrow keys and Enter only work when switcher is open
                if (isSwitcherOpen) {
                    var fileIds = Object.keys(files);

                    // ArrowDown: Move selection down
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        selectedFileIndex = (selectedFileIndex + 1) % fileIds.length;
                        renderTabs();
                        return;
                    }

                    // ArrowUp: Move selection up
                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        selectedFileIndex = (selectedFileIndex - 1 + fileIds.length) % fileIds.length;
                        renderTabs();
                        return;
                    }

                    // Enter: Switch to selected file
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        var selectedFileId = fileIds[selectedFileIndex];
                        if (selectedFileId) {
                            switchToFile(selectedFileId);
                        }
                        return;
                    }

                    // Escape: Close file switcher
                    if (e.key === 'Escape') {
                        toggleFileSwitcher();
                        return;
                    }
                }
            });

            // Language switcher
            document.getElementById('language-selector').addEventListener('change', function() {
                monaco.editor.setModelLanguage(editor.getModel(), this.value);
                if (currentFileId && files[currentFileId]) {
                    files[currentFileId].language = this.value;
                    saveFiles();
                }
            });

            // Theme switcher
            document.getElementById('theme-selector').addEventListener('change', function() {
                monaco.editor.setTheme(this.value);
                localStorage.setItem('editorTheme', this.value);
            });

            // Auto-resize
            window.addEventListener('resize', function() {
                editor.layout();
            });

            // Initialize
            loadFiles();
        });
    </script>
</body>
</html>
